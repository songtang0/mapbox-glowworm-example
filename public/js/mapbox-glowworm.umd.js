!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Glowworm=e()}(this,function(){"use strict";var c=function(){return(c=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function y(t,e,r){if(r||2===arguments.length)for(var o,n=0,a=e.length;n<a;n++)!o&&n in e||((o=o||Array.prototype.slice.call(e,0,n))[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}var t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self,e=t||e||Function("return this")(),r=e.Symbol,o=Object.prototype,I=o.hasOwnProperty,U=o.toString,i=r?r.toStringTag:void 0;var k=Object.prototype.toString;var D="[object Null]",G="[object Undefined]",R=r?r.toStringTag:void 0;function n(t){if(null==t)return void 0===t?G:D;if(R&&R in Object(t)){var e=t,r=I.call(e,i),o=e[i];try{var n=!(e[i]=void 0)}catch(t){}var a=U.call(e);return n&&(r?e[i]=o:delete e[i]),a}return k.call(t)}function a(t){return null!=t&&"object"==typeof t}var S=Array.isArray;function F(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var W="[object AsyncFunction]",q="[object Function]",$="[object GeneratorFunction]",N="[object Proxy]";function V(t){if(F(t))return(t=n(t))==q||t==$||t==W||t==N}var o=e["__core-js_shared__"],K=(o=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"";var J=Function.prototype.toString;function u(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var H=/^\[object .+?Constructor\]$/,o=Function.prototype,l=Object.prototype,o=o.toString,l=l.hasOwnProperty,Q=RegExp("^"+o.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function X(t){var e;return F(t)&&(e=t,!(K&&K in e))&&(V(t)?Q:H).test(u(t))}function s(t,e){e=e;t=null==(t=t)?void 0:t[e];return X(t)?t:void 0}var o=s(e,"WeakMap"),Y=Object.create;function p(){}var Z=function(t){if(!F(t))return{};if(Y)return Y(t);p.prototype=t;t=new p;return p.prototype=void 0,t};var tt=function(){try{var t=s(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var et=/^(?:0|[1-9]\d*)$/;function rt(t,e,r){"__proto__"==e&&tt?tt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function ot(t,e){return t===e||t!=t&&e!=e}var nt=Object.prototype.hasOwnProperty;function at(t,e,r){var o=t[e];nt.call(t,e)&&ot(o,r)&&(void 0!==r||e in t)||rt(t,e,r)}function z(t,e,r,o){for(var n=!r,a=(r=r||{},-1),i=e.length;++a<i;){var c=e[a],u=o?o(r[c],t[c],c,r,t):void 0;(n?rt:at)(r,c,u=void 0===u?t[c]:u)}return r}var it=9007199254740991;function ct(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=it}function ut(t){return null!=t&&ct(t.length)&&!V(t)}var lt=Object.prototype;function C(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||lt)}function st(t){return a(t)&&"[object Arguments]"==n(t)}var l=Object.prototype,pt=l.hasOwnProperty,ft=l.propertyIsEnumerable,yt=st(function(){return arguments}())?st:function(t){return a(t)&&pt.call(t,"callee")&&!ft.call(t,"callee")};var l="object"==typeof exports&&exports&&!exports.nodeType&&exports,f=l&&"object"==typeof module&&module&&!module.nodeType&&module,f=f&&f.exports===l?e.Buffer:void 0,bt=(f?f.isBuffer:void 0)||function(){return!1},b={};function d(e){return function(t){return e(t)}}b["[object Float32Array]"]=b["[object Float64Array]"]=b["[object Int8Array]"]=b["[object Int16Array]"]=b["[object Int32Array]"]=b["[object Uint8Array]"]=b["[object Uint8ClampedArray]"]=b["[object Uint16Array]"]=b["[object Uint32Array]"]=!0,b["[object Arguments]"]=b["[object Array]"]=b["[object ArrayBuffer]"]=b["[object Boolean]"]=b["[object DataView]"]=b["[object Date]"]=b["[object Error]"]=b["[object Function]"]=b["[object Map]"]=b["[object Number]"]=b["[object Object]"]=b["[object RegExp]"]=b["[object Set]"]=b["[object String]"]=b["[object WeakMap]"]=!1;var l="object"==typeof exports&&exports&&!exports.nodeType&&exports,h=l&&"object"==typeof module&&module&&!module.nodeType&&module,v=h&&h.exports===l&&t.process,f=function(){try{var t=h&&h.require&&h.require("util").types;return t?t:v&&v.binding&&v.binding("util")}catch(t){}}(),l=f&&f.isTypedArray,dt=l?d(l):function(t){return a(t)&&ct(t.length)&&!!b[n(t)]},ht=Object.prototype.hasOwnProperty;function vt(t,e){var r,o,n,a,i=S(t),c=!i&&yt(t),u=!i&&!c&&bt(t),l=!i&&!c&&!u&&dt(t),s=i||c||u||l,p=s?function(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}(t.length,String):[],f=p.length;for(r in t)!e&&!ht.call(t,r)||s&&("length"==r||u&&("offset"==r||"parent"==r)||l&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(a=void 0,a=typeof(o=r),(n=null==(n=f)?9007199254740991:n)&&("number"==a||"symbol"!=a&&et.test(o))&&-1<o&&o%1==0&&o<n))||p.push(r);return p}function jt(e,r){return function(t){return e(r(t))}}var gt=jt(Object.keys,Object),_t=Object.prototype.hasOwnProperty;function mt(t){return(ut(t)?vt:function(t){if(!C(t))return gt(t);var e,r=[];for(e in Object(t))_t.call(t,e)&&"constructor"!=e&&r.push(e);return r})(t)}var wt=Object.prototype.hasOwnProperty;function Ot(t){if(!F(t)){var e=t,r=[];if(null!=e)for(var o in Object(e))r.push(o);return r}var n,a=C(t),i=[];for(n in t)("constructor"!=n||!a&&wt.call(t,n))&&i.push(n);return i}function At(t){return ut(t)?vt(t,!0):Ot(t)}var j=s(Object,"create");var xt=Object.prototype.hasOwnProperty;var Mt=Object.prototype.hasOwnProperty;function g(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function _(t,e){for(var r=t.length;r--;)if(ot(t[r][0],e))return r;return-1}g.prototype.clear=function(){this.__data__=j?j(null):{},this.size=0},g.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},g.prototype.get=function(t){var e,r=this.__data__;return j?"__lodash_hash_undefined__"===(e=r[t])?void 0:e:xt.call(r,t)?r[t]:void 0},g.prototype.has=function(t){var e=this.__data__;return j?void 0!==e[t]:Mt.call(e,t)},g.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=j&&void 0===e?"__lodash_hash_undefined__":e,this};var St=Array.prototype.splice;function m(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}m.prototype.clear=function(){this.__data__=[],this.size=0},m.prototype.delete=function(t){var e=this.__data__;return!((t=_(e,t))<0||(t==e.length-1?e.pop():St.call(e,t,1),--this.size,0))},m.prototype.get=function(t){var e=this.__data__;return(t=_(e,t))<0?void 0:e[t][1]},m.prototype.has=function(t){return-1<_(this.__data__,t)},m.prototype.set=function(t,e){var r=this.__data__,o=_(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this};var w=s(e,"Map");function O(t,e){var r,o,t=t.__data__;return("string"==(o=typeof(r=e))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==r:null===r)?t["string"==typeof e?"string":"hash"]:t.map}function A(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function Ft(t,e){for(var r=-1,o=e.length,n=t.length;++r<o;)t[n+r]=e[r];return t}A.prototype.clear=function(){this.size=0,this.__data__={hash:new g,map:new(w||m),string:new g}},A.prototype.delete=function(t){return t=O(this,t).delete(t),this.size-=t?1:0,t},A.prototype.get=function(t){return O(this,t).get(t)},A.prototype.has=function(t){return O(this,t).has(t)},A.prototype.set=function(t,e){var r=O(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this};var zt=jt(Object.getPrototypeOf,Object);function P(t){t=this.__data__=new m(t);this.size=t.size}P.prototype.clear=function(){this.__data__=new m,this.size=0},P.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},P.prototype.get=function(t){return this.__data__.get(t)},P.prototype.has=function(t){return this.__data__.has(t)},P.prototype.set=function(t,e){var r=this.__data__;if(r instanceof m){var o=r.__data__;if(!w||o.length<199)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new A(o)}return r.set(t,e),this.size=r.size,this};var t="object"==typeof exports&&exports&&!exports.nodeType&&exports,l=t&&"object"==typeof module&&module&&!module.nodeType&&module,l=l&&l.exports===t?e.Buffer:void 0,Ct=l?l.allocUnsafe:void 0;function Pt(){return[]}var Lt=Object.prototype.propertyIsEnumerable,Bt=Object.getOwnPropertySymbols,Et=Bt?function(e){if(null==e)return[];e=Object(e);for(var t=Bt(e),r=function(t){return Lt.call(e,t)},o=-1,n=null==t?0:t.length,a=0,i=[];++o<n;){var c=t[o];r(c,o,t)&&(i[a++]=c)}return i}:Pt;var Tt=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Ft(e,Et(t)),t=zt(t);return e}:Pt;function It(t,e,r){e=e(t);return S(t)?e:Ft(e,r(t))}function Ut(t){return It(t,mt,Et)}function kt(t){return It(t,At,Tt)}var t=s(e,"DataView"),l=s(e,"Promise"),x=s(e,"Set"),Dt="[object Map]",Gt="[object Promise]",Rt="[object Set]",Wt="[object WeakMap]",qt="[object DataView]",$t=u(t),Nt=u(w),Vt=u(l),Kt=u(x),Jt=u(o),M=n,Ht=M=t&&M(new t(new ArrayBuffer(1)))!=qt||w&&M(new w)!=Dt||l&&M(l.resolve())!=Gt||x&&M(new x)!=Rt||o&&M(new o)!=Wt?function(t){var e=n(t),t="[object Object]"==e?t.constructor:void 0,t=t?u(t):"";if(t)switch(t){case $t:return qt;case Nt:return Dt;case Vt:return Gt;case Kt:return Rt;case Jt:return Wt}return e}:M,Qt=Object.prototype.hasOwnProperty;var Xt=e.Uint8Array;function Yt(t){var e=new t.constructor(t.byteLength);return new Xt(e).set(new Xt(t)),e}var Zt=/\w*$/;var t=r?r.prototype:void 0,te=t?t.valueOf:void 0;function ee(t,e,r){var o,n,a,i,c=t.constructor;switch(e){case"[object ArrayBuffer]":return Yt(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return a=t,i=(i=r)?Yt(a.buffer):a.buffer,new a.constructor(i,a.byteOffset,a.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return i=t,a=(a=r)?Yt(i.buffer):i.buffer,new i.constructor(a,i.byteOffset,i.length);case"[object Map]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return(n=new(o=t).constructor(o.source,Zt.exec(o))).lastIndex=o.lastIndex,n;case"[object Set]":return new c;case"[object Symbol]":return o=t,te?Object(te.call(o)):{}}}var l=f&&f.isMap,re=l?d(l):function(t){return a(t)&&"[object Map]"==Ht(t)};var x=f&&f.isSet,oe=x?d(x):function(t){return a(t)&&"[object Set]"==Ht(t)},ne=1,ae=2,ie=4,ce="[object Arguments]",ue="[object Function]",le="[object GeneratorFunction]",se="[object Object]",L={};function B(r,o,n,t,e,a){var i,c=o&ne,u=o&ae,l=o&ie;if(void 0===(i=n?e?n(r,t,e,a):n(r):i)){if(!F(r))return r;var s,p,f,y,b,t=S(r);if(t){if(g=(_=r).length,b=new _.constructor(g),g&&"string"==typeof _[0]&&Qt.call(_,"index")&&(b.index=_.index,b.input=_.input),i=b,!c){var d=r,h=i,v=-1,j=d.length;for(h=h||Array(j);++v<j;)h[v]=d[v];return h}}else{var g=Ht(r),_=g==ue||g==le;if(bt(r))return b=r,(y=c)?b.slice():(y=b.length,y=Ct?Ct(y):new b.constructor(y),b.copy(y),y);if(g==se||g==ce||_&&!e){if(i=u||_||"function"!=typeof(y=r).constructor||C(y)?{}:Z(zt(y)),!c)return u?(f=s=r,f=(p=i)&&z(f,At(f),p),z(s,Tt(s),f)):(s=p=r,m=(f=i)&&z(s,mt(s),f),z(p,Et(p),m))}else{if(!L[g])return e?r:{};i=ee(r,g,c)}}var m=(a=a||new P).get(r);if(m)return m;a.set(r,i),oe(r)?r.forEach(function(t){i.add(B(t,o,n,t,r,a))}):re(r)&&r.forEach(function(t,e){i.set(e,B(t,o,n,e,r,a))});for(var w=t?void 0:(l?u?kt:Ut:u?At:mt)(r),O=w||r,A=function(t,e){w&&(t=r[e=t]),at(i,e,B(t,o,n,e,r,a))},x=-1,M=null==O?0:O.length;++x<M&&!1!==A(O[x],x,O););}return i}L[ce]=L["[object Array]"]=L["[object ArrayBuffer]"]=L["[object DataView]"]=L["[object Boolean]"]=L["[object Date]"]=L["[object Float32Array]"]=L["[object Float64Array]"]=L["[object Int8Array]"]=L["[object Int16Array]"]=L["[object Int32Array]"]=L["[object Map]"]=L["[object Number]"]=L[se]=L["[object RegExp]"]=L["[object Set]"]=L["[object String]"]=L["[object Symbol]"]=L["[object Uint8Array]"]=L["[object Uint8ClampedArray]"]=L["[object Uint16Array]"]=L["[object Uint32Array]"]=!0,L["[object Error]"]=L[ue]=L["[object WeakMap]"]=!1;var pe=1,fe=4;var E=3.141592653589793,ye=6378245,be=.006693421622965943;function de(t,e){var r,o,n,a,i;return i=e,(a=t)<72.004||137.8347<a||i<.8293||55.8271<i?[t,e]:(r=2*(a=t-105)-100+3*(i=e-35)+.2*i*i+.1*a*i+.2*Math.sqrt(Math.abs(a)),a=(r+=2*(20*Math.sin(6*a*E)+20*Math.sin(2*a*E))/3)+2*(20*Math.sin(i*E)+40*Math.sin(i/3*E))/3+2*(160*Math.sin(i/12*E)+320*Math.sin(i*E/30))/3,i=300+(r=t-105)+2*(i=e-35)+.1*r*r+.1*r*i+.1*Math.sqrt(Math.abs(r)),i=(i+=2*(20*Math.sin(6*r*E)+20*Math.sin(2*r*E))/3)+2*(20*Math.sin(r*E)+40*Math.sin(r/3*E))/3+2*(150*Math.sin(r/12*E)+300*Math.sin(r/30*E))/3,r=e/180*E,o=Math.sin(r),o=1-be*o*o,n=Math.sqrt(o),a=180*a/(ye*(1-be)/(o*n)*E),[2*t-(t+(i=180*i/(ye/n*Math.cos(r)*E))),2*e-(e+a)])}function he(t,e){t=t,e=e,r=52.35987755982988,t-=.0065,e-=.006,o=Math.sqrt(t*t+e*e)-2e-5*Math.sin(e*r),e=Math.atan2(e,t)-3e-6*Math.cos(t*r);var r,o,t=[o*Math.cos(e),o*Math.sin(e)];return de(t[0],t[1])}function ve(t,e,r){return{type:"geojson",data:function(t,e,r){if(e===void 0)e="WGS84";if(r===void 0)r=false;var o=r?me(t):t;return we(je(o,e))}(t,e=void 0===e?"WGS84":e,r=void 0===r?!1:r),cluster:!1}}var je=function(t,i){return void 0===i&&(i="WGS84"),null==t?void 0:t.map(function(t,e){var r=t.level||"层级类型",o=t.realGps?y([],t.realGps,!0):[],n=y([],t.gps,!0),a=[],a="BD09"===i?he(n[0],n[1]):"GCJ02"===i?de(n[0],n[1]):y([],n,!0),o={realLngGps:(o||a)[0],realLatGps:(o||a)[1]};return{type:"Feature",properties:c({data:t.data,count:t.count||0,lng:a[0],lat:a[1],queryLng:n[0],queryLat:n[1],level:r,point_type:t.point_type},o),geometry:{type:"Point",coordinates:y([],a,!0)}}})};function ge(t,e,r){for(var o=String(t),n=0;n<e;n++)o="".concat(o).concat(r||0===r?r:Math.floor(9*Math.random()+1));return o}function _e(t,e){var t=String(t),r=t.split(".")[0],o=t.split(".")[1];return o?(o=ge(o,6-o.length,0),o=ge(o,e),parseFloat("".concat(r,".").concat(o))):Number(t)}var me=function(t){return t.map(function(t){var e=t.gps,r=e[0],e=e[1],r=_e(r,3),e=_e(e,3);return c(c({},t),{realGps:t.gps,gps:[r,e]})})},we=function(t){return{type:"FeatureCollection",features:t=void 0===t?[]:t}},Oe=["blue","#00CFFF","lightBlue","#28A4FF","green","#00CE5A","orange","#F6A109","red","#E00F20","yellow","#FFD600"],Ae=["blue","#0060E9","lightBlue","#006AB0","green","#00856E","orange","#A77D00","yellow","#A97001","deepRed","#931721","red","#F84D04"],xe=["blue","#14E6FF","lightBlue","#28A4FF","green","#00CE5A","orange","#F6A109","yellow","#FFD600","deepRed","#E00F20","red","#E64500"];function T(t){this.map={},this.options={},this.map=t}return T.prototype.addCommonLayer=function(t,e,r){var r=r||this.options,o=r.dotTypeKey,o=void 0===o?"level":o,n=r.mapColorList,a=r.circleBlur,i=r.circleColor,c=r.circleOpacity,u=r.circleRadius,l=r.dotSize,s=r.circleStrokeWidth,p=r.circleStrokeColor,f=r.coordinateSystemType,r=r.needRandom;this.map.addSource(e,ve(t,void 0===f?"WGS84":f,void 0!==r&&r)),this.map.addLayer({id:e,type:"circle",source:e,paint:{"circle-blur":null!=(t=a)?t:0,"circle-color":null!=(f=i)?f:y(y(["match",["get",o]],n||Oe,!0),["rgba(237,97,147,0.9)"],!1),"circle-color-transition":{duration:2},"circle-opacity":c,"circle-radius":null!=(r=u)?r:y(["interpolate",["exponential",.1],["zoom"]],l||[14.1,3,32,9],!0),"circle-stroke-width":null!=(e=s)?e:0,"circle-stroke-color":null!=(a=p)?a:"#ffffff"}})},T.prototype.addGlowwormLayer=function(t,e,r){var o=e.dotTypeKey,o=void 0===o?"level":o,n=e.glowwormLayerName,a=e.glowwormInnerColorList,i=e.glowwormOutColorList,c=e.circleOpacity,e=e.circleBlur;this.addCommonLayer(t,n||"glowworm",{circleOpacity:c||.4,circleBlur:e||3,circleColor:y(y(["match",["get",o]],i||Ae,!0),["rgba(237,97,147,0.9)"],!1),circleRadius:["interpolate",["exponential",.1],["zoom"],14.1,14,32,22]}),this.addCommonLayer(t,"glowworm2",{circleOpacity:c||.4,circleBlur:e||3,circleColor:y(y(["match",["get",o]],a||xe,!0),["rgba(237,97,147,0.9)"],!1),circleRadius:["interpolate",["exponential",.1],["zoom"],14.1,9,32,12]}),this.addCommonLayer(t,"glowworm3",{circleOpacity:1,circleBlur:0,circleColor:"#ffffff",circleRadius:["interpolate",["exponential",.1],["zoom"],14.1,1.3,32,2.2]})},T.prototype.addSimpleCityLayer=function(){this.map.addLayer({id:"simple-cities",type:"symbol",source:"simpleCity",minzoom:5,maxzoom:12,layout:{"text-field":"{title}","text-font":["DIN Pro Medium","Arial Unicode MS Regular"],"text-size":["interpolate",["cubic-bezier",.2,0,.9,1],["zoom"],2,["step",["get","symbolrank"],3,3,3],6,["step",["get","symbolrank"],23.400000000000002,6,20.8,7,18.2],8,["step",["get","symbolrank"],10,9,10,10,18.2],15,["step",["get","symbolrank"],31.200000000000003,9,26,12,20.8,15,18.2]]},paint:{"text-color":"hsl(215, 28%, 71%)","text-halo-color":"hsla(215, 91%, 48%, 0.24)","text-halo-width":1,"icon-opacity":.63,"text-halo-blur":1}})},T.prototype.addChinaCountryBoundaryLine=function(t){var e={id:"south-line",type:"line",source:{type:"geojson",lineMetrics:!0,data:(e=(t=t).features[0].geometry.coordinates,(t=B(t,pe|fe)).features[0].geometry.coordinates=r(e),t)},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"rgb(50, 121, 149)","line-width":2,"line-opacity":.9,"line-dasharray":[4,0]}};function r(t){return t.map(function(t){return t&&Array.isArray(t)&&2===t.length&&"number"==typeof t[0]?de(t[0],t[1]):r(t)})}this.map.addLayer(e)},T.prototype.addSimpleTaiWanTitle=function(){this.map.addSource("taiwan",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[120.99362840456797,23.916543753069078]},properties:{title:"台湾省"}}]},cluster:!0}),this.map.addLayer({id:"taiwan",type:"symbol",source:"taiwan",minzoom:2,maxzoom:12,layout:{"text-field":"{title}","text-font":["Open Sans Regular"],"text-size":["interpolate",["exponential",.1],["zoom"],5,12,10,28]},paint:{"text-color":"hsl(215, 14%, 82%)"}})},T});
